<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏±‡∏ö‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á OK Mobile</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
</head>
<body class="bg-gradient-to-br from-purple-200 via-pink-200 to-yellow-200 min-h-screen flex flex-col items-center p-4">

  <h1 class="text-4xl font-extrabold text-purple-700 my-6 text-center">üéÅ ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô OK Mobile</h1>

  <div id="coupon-container" class="grid grid-cols-1 sm:grid-cols-2 gap-6 max-w-6xl w-full"></div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz88gEDr3AeoJmHDgcwjabwk08NL5Nx5x1E8n6Ia3DohIv7V3fXrj-tbIzoLa7bSqG4/exec";

    const coupons = [
      { title: "‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏°‡∏∑‡∏≠2", description: "‡∏•‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ 200 ‡∏ö‡∏≤‡∏ó", color: "#f43f5e", line_url: "https://lin.ee/B63EGhv" },
      { title: "‡∏ü‡∏¥‡∏•‡πå‡∏°‡∏Å‡∏±‡∏ô‡∏£‡∏≠‡∏¢‡∏ü‡∏£‡∏µ", description: "‡πÅ‡∏ñ‡∏°‡∏ü‡∏£‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ã‡∏∑‡πâ‡∏≠‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠", color: "#3b82f6", line_url: "https://lin.ee/B63EGhv" },
    ];

    function getDeviceId() {
      let id = localStorage.getItem("device_id");
      if (!id) {
        id = "dev-" + Math.random().toString(36).substr(2, 9);
        localStorage.setItem("device_id", id);
      }
      return id;
    }

    const container = document.getElementById("coupon-container");

    coupons.forEach((c, index) => {
      const div = document.createElement("div");
      div.className = "bg-white shadow-2xl rounded-3xl p-6 text-center relative overflow-hidden";
      div.innerHTML = `
        <h2 class="text-2xl font-bold mb-4" style="color:${c.color}">${c.title}</h2>
        <p class="mb-6 text-gray-700">${c.description}</p>
        <a href="#"
           onclick="window.open('${c.line_url}','_blank'); return false;"
           class="block bg-green-500 text-white px-5 py-3 rounded-xl font-bold text-lg hover:bg-green-600 transition mb-3 add-line-btn">
           ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô LINE
        </a>
        <button style="background-color:${c.color};"
                class="text-white px-5 py-3 rounded-xl font-bold text-lg hover:opacity-90 transition get-code-btn disabled:opacity-50 w-full"
                disabled>üéüÔ∏è ‡∏£‡∏±‡∏ö‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á</button>
        <p class="mt-4 font-bold result" style="color:${c.color}"></p>
      `;
      container.appendChild(div);
    });

    document.querySelectorAll(".add-line-btn").forEach((btn) => {
      const getCodeBtn = btn.nextElementSibling;
      btn.addEventListener("click", () => {
        setTimeout(() => {
          getCodeBtn.disabled = false;
          alert("‚úÖ ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô LINE ‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏î‡∏£‡∏±‡∏ö‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢!");
        }, 500);
      });
    });

    document.querySelectorAll(".get-code-btn").forEach((btn, index) => {
      btn.addEventListener("click", async () => {
        const resultElem = btn.parentElement.querySelector(".result");
        const deviceId = getDeviceId();

        try {
          const res = await fetch(`${SCRIPT_URL}?device_id=${deviceId}&coupon_id=${index}`);
          const data = await res.json();

          if (data.status === "ok") {
            resultElem.textContent = "üéâ ‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: " + data.code;
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 }, colors: [btn.style.backgroundColor, "#fff", "#ffd700"] });
          } else {
            resultElem.textContent = "‚ö†Ô∏è " + data.message;
          }
        } catch (err) {
          resultElem.textContent = "‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà";
        }
      });
    });
  </script>

</body>
</html>
